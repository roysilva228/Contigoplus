<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Menú del Minimarket</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f4f4f4;
    }
    h1, h2 {
      text-align: center;
      color: #333;
    }
    .menu-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }
    .product-card {
      background: white;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      text-align: center;
    }
    .product-card h3 {
      margin: 0;
      color: #2c3e50;
    }
    .product-card p {
      margin: 5px 0;
      color: #555;
    }
    .price {
      font-weight: bold;
      color: #27ae60;
    }
    .login-container, .admin-container {
      max-width: 400px;
      margin: 20px auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    input, button, textarea {
      display: block;
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }
    button {
      background: #3498db;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background: #2980b9;
    }
    .hidden {
      display: none;
    }
    #admin-section table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    #admin-section th, #admin-section td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    #admin-section th {
      background: #3498db;
      color: white;
    }
    #admin-section button {
      padding: 5px;
      margin: 0 5px;
    }
  </style>
</head>
<body>

<!-- LOGIN -->
<div id="login-section" class="login-container">
  <h2>Iniciar Sesión</h2>
  <input type="email" id="email" placeholder="Correo electrónico" />
  <input type="password" id="password" placeholder="Contraseña" />
  <button onclick="login()">Iniciar Sesión</button>
  <p>¿No tienes cuenta? <a href="#" onclick="showSignUp()">Regístrate</a></p>
</div>

<!-- REGISTRO -->
<div id="signup-section" class="login-container hidden">
  <h2>Registrarse</h2>
  <input type="email" id="signup-email" placeholder="Correo electrónico" />
  <input type="password" id="signup-password" placeholder="Contraseña" />
  <button onclick="signUp()">Registrarse</button>
  <p>¿Ya tienes cuenta? <a href="#" onclick="showLogin()">Inicia sesión</a></p>
</div>

<!-- MENÚ DE PRODUCTOS -->
<div id="menu-section" class="hidden">
  <h1>Menú del Minimarket</h1>
  <div id="menu-container" class="menu-container"></div>
  <button onclick="showAdmin()" class="hidden" id="admin-button">Administrar Productos</button>
  <button onclick="logout()">Cerrar Sesión</button>
</div>

<!-- ADMINISTRACIÓN -->
<div id="admin-section" class="admin-container hidden">
  <h2>Administrar Productos</h2>
  <input type="text" id="product-name" placeholder="Nombre del producto" />
  <input type="number" id="product-price" placeholder="Precio" step="0.01" />
  <textarea id="product-description" placeholder="Descripción"></textarea>
  <input type="hidden" id="edit-id" />
  <button onclick="addOrUpdateProduct()">Agregar/Actualizar Producto</button>

  <!-- Carga desde Excel -->
  <h3>Cargar productos desde archivo Excel</h3>
  <input type="file" accept=".xlsx" onchange="handleFileUpload(event)" />

  <table id="product-table">
    <thead>
      <tr>
        <th>Nombre</th>
        <th>Precio</th>
        <th>Descripción</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody id="product-table-body"></tbody>
  </table>

  <button onclick="showMenu()">Volver al Menú</button>
</div>

<!-- LIBRERÍAS FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>

<!-- LIBRERÍA XLSX -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<!-- SCRIPT PRINCIPAL -->
<script>
  // Configuración de Firebase (reemplaza con tus datos)
 const firebaseConfig = {
    apiKey: "AIzaSyCpgoaw-lnE70CzGZBl2P2TZdeXK1RGjs8",
    authDomain: "minimarket-app-c551b.firebaseapp.com",
    projectId: "minimarket-app-c551b",
    storageBucket: "minimarket-app-c551b.firebasestorage.app",
    messagingSenderId: "1022324994134",
    appId: "1:1022324994134:web:66b58be5ec8a5e166a4bf7",
    measurementId: "G-FZR0HL0ZRZ"
  };



  // Inicializar Firebase
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  // Login
  function login() {
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    auth.signInWithEmailAndPassword(email, password)
      .then(() => showMenu())
      .catch(error => alert('Error al iniciar sesión: ' + error.message));
  }

  // Registro
  function signUp() {
    const email = document.getElementById('signup-email').value;
    const password = document.getElementById('signup-password').value;
    auth.createUserWithEmailAndPassword(email, password)
      .then(() => showMenu())
      .catch(error => alert('Error al registrarse: ' + error.message));
  }

  // Mostrar productos
  async function displayProducts() {
    const menuContainer = document.getElementById('menu-container');
    menuContainer.innerHTML = '';
    const snapshot = await db.collection('products').get();
    snapshot.forEach(doc => {
      const product = doc.data();
      const card = document.createElement('div');
      card.className = 'product-card';
      card.innerHTML = `
        <h3>${product.name}</h3>
        <p class="price">$${product.price.toFixed(2)}</p>
        <p>${product.description}</p>
      `;
      menuContainer.appendChild(card);
    });
  }

  // Tabla de administración
  async function displayProductTable() {
    const tableBody = document.getElementById('product-table-body');
    tableBody.innerHTML = '';
    const snapshot = await db.collection('products').get();
    snapshot.forEach(doc => {
      const product = doc.data();
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${product.name}</td>
        <td>$${product.price.toFixed(2)}</td>
        <td>${product.description}</td>
        <td>
          <button onclick="editProduct('${doc.id}', '${product.name}', ${product.price}, '${product.description}')">Editar</button>
          <button onclick="deleteProduct('${doc.id}')">Eliminar</button>
        </td>
      `;
      tableBody.appendChild(row);
    });
  }

  // Agregar o actualizar
  async function addOrUpdateProduct() {
    const name = document.getElementById('product-name').value;
    const price = parseFloat(document.getElementById('product-price').value);
    const description = document.getElementById('product-description').value;
    const editId = document.getElementById('edit-id').value;

    if (name && !isNaN(price) && description) {
      if (editId) {
        await db.collection('products').doc(editId).update({ name, price, description });
      } else {
        await db.collection('products').add({ name, price, description });
      }
      displayProducts();
      displayProductTable();
      clearForm();
    } else {
      alert('Por favor, completa todos los campos correctamente.');
    }
  }

  function editProduct(id, name, price, description) {
    document.getElementById('product-name').value = name;
    document.getElementById('product-price').value = price;
    document.getElementById('product-description').value = description;
    document.getElementById('edit-id').value = id;
  }

  async function deleteProduct(id) {
    if (confirm('¿Estás seguro de eliminar este producto?')) {
      await db.collection('products').doc(id).delete();
      displayProducts();
      displayProductTable();
    }
  }

  function clearForm() {
    document.getElementById('product-name').value = '';
    document.getElementById('product-price').value = '';
    document.getElementById('product-description').value = '';
    document.getElementById('edit-id').value = '';
  }

  function logout() {
    auth.signOut().then(() => showLogin());
  }

  function showLogin() {
    document.getElementById('login-section').classList.remove('hidden');
    document.getElementById('signup-section').classList.add('hidden');
    document.getElementById('menu-section').classList.add('hidden');
    document.getElementById('admin-section').classList.add('hidden');
  }

  function showSignUp() {
    document.getElementById('login-section').classList.add('hidden');
    document.getElementById('signup-section').classList.remove('hidden');
    document.getElementById('menu-section').classList.add('hidden');
    document.getElementById('admin-section').classList.add('hidden');
  }

  function showMenu() {
    document.getElementById('login-section').classList.add('hidden');
    document.getElementById('signup-section').classList.add('hidden');
    document.getElementById('menu-section').classList.remove('hidden');
    document.getElementById('admin-section').classList.add('hidden');
    document.getElementById('admin-button').classList.remove('hidden');
    displayProducts();
  }

  function showAdmin() {
    document.getElementById('login-section').classList.add('hidden');
    document.getElementById('signup-section').classList.add('hidden');
    document.getElementById('menu-section').classList.add('hidden');
    document.getElementById('admin-section').classList.remove('hidden');
    displayProductTable();
  }

  // Importar desde Excel
  function handleFileUpload(event) {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function(e) {
      const data = new Uint8Array(e.target.result);
      const workbook = XLSX.read(data, { type: 'array' });
      const sheet = workbook.Sheets[workbook.SheetNames[0]];
      const json = XLSX.utils.sheet_to_json(sheet, { defval: '' });

      json.forEach(async row => {
        if (row.name && row.price && row.description) {
          await db.collection('products').add({
            name: row.name,
            price: parseFloat(row.price),
            description: row.description
          });
        }
      });

      alert('Productos importados con éxito');
      displayProducts();
      displayProductTable();
    };

    reader.readAsArrayBuffer(file);
  }

  // Escuchar autenticación
  auth.onAuthStateChanged(user => {
    if (user) showMenu();
    else showLogin();
  });
</script>
</body>
</html>
